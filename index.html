<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>Графік прибирань</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body { 
  background: linear-gradient(135deg, #0f172a, #1e3a8a); 
  font-family: 'Poppins', sans-serif; 
}
button { transition: all 0.2s ease; }
button:hover { transform: scale(1.05); }
input { background:#1e293b; color:#f8fafc; border:none; border-radius:6px; padding:6px 8px; transition:0.2s; }
input:disabled { background:#0f172a; color:#94a3b8; }
tr:hover { background: rgba(255,255,255,0.05); transition: 0.2s; }
</style>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
</head>
<body class="flex items-center justify-center min-h-screen">
<div id="login-screen" class="w-96 p-8 bg-gradient-to-br from-blue-700 to-cyan-500 rounded-3xl shadow-2xl">
  <h1 class="text-3xl font-bold mb-6 text-white text-center">Вхід за квартирою</h1>
  <input id="apt" type="number" placeholder="Номер квартири" class="w-full mb-3"/><br>
  <input id="pass" type="password" placeholder="Пароль" class="w-full mb-5"/><br>
  <button id="loginBtn" class="w-full py-3 bg-orange-400 rounded-3xl font-semibold text-gray-900">Увійти</button>
</div>

<div id="main-screen" class="hidden flex-col w-11/12 max-w-4xl">
  <div class="flex justify-between items-center mb-4 mt-4">
    <h1 class="text-3xl font-bold text-white">Графік прибирань</h1>
    <button id="addBtn" class="px-5 py-2 bg-green-400 rounded-3xl font-semibold text-gray-900 shadow-lg">Додати запис</button>
  </div>
  <div class="overflow-x-auto rounded-2xl shadow-xl">
    <table class="min-w-full border-collapse text-white">
      <thead class="bg-cyan-600">
        <tr>
          <th class="px-5 py-3 border">Дата</th>
          <th class="px-5 py-3 border">Квартира</th>
          <th class="px-5 py-3 border">Текст</th>
          <th class="px-5 py-3 border">Дія</th>
        </tr>
      </thead>
      <tbody id="tbody" class="bg-slate-900/80"></tbody>
    </table>
  </div>
</div>

<script>
let token=null;
let apt=null;
const loginScreen=document.getElementById('login-screen');
const mainScreen=document.getElementById('main-screen');
const tbody=document.getElementById('tbody');

async function loadData(){
  const r=await fetch('/api/load');
  const data=await r.json();
  tbody.innerHTML='';
  data.forEach((row,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td class="border px-4 py-2">${row.date}</td>
      <td class="border px-4 py-2">${row.apt}</td>
      <td class="border px-4 py-2">
        <input type="text" class="w-full bg-slate-800/80 text-white p-1 rounded" value="${row.text}" ${row.author===apt?'':'disabled'}>
      </td>
      <td class="border px-4 py-2 flex gap-2 justify-center">
        ${row.author===apt?'<button class="updateBtn bg-blue-500 px-3 py-1 rounded text-white font-semibold">Зберегти</button><button class="delBtn bg-red-500 px-3 py-1 rounded text-white font-semibold">Видалити</button>':''}
      </td>`;
    tbody.appendChild(tr);

    if(row.author===apt){
      tr.querySelector('.updateBtn').onclick=async ()=>{
        const val=tr.querySelector('input').value;
        await fetch('/api/update',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({token,index:i,text:val})});
        loadData();
      };
      tr.querySelector('.delBtn').onclick=async ()=>{
        await fetch('/api/delete',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({token,index:i})});
        loadData();
      };
    }
  });
}

document.getElementById('loginBtn').onclick=async ()=>{
  const a=document.getElementById('apt').value;
  const p=document.getElementById('pass').value;
  const r=await fetch('/api/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({apt:a,password:p})});
  const data=await r.json();
  if(data.ok){
    token=data.token; apt=data.apt;
    loginScreen.classList.add('hidden');
    mainScreen.classList.remove('hidden');
    loadData();
  } else alert('Невірний пароль');
};

document.getElementById('addBtn').onclick=async ()=>{
  await fetch('/api/add',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({token})});
  loadData();
};
</script>
</body>
</html>
